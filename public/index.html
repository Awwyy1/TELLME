<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tellme.mom</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Instrument+Sans:wght@300;400&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #FDF8F3;
  --warm: #F5EDE0;
  --text: #2C2318;
  --muted: #A8967E;
  --accent: #C4785A;
  --accent2: #8B4F3A;
  --soft: #EDE0D0;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { height: 100%; }

body {
  min-height: 100%;
  background: var(--bg);
  color: var(--text);
  font-family: 'Instrument Sans', sans-serif;
  overflow-x: hidden;
}

/* Soft warm gradient bg */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse 80% 60% at 20% 10%, rgba(196,120,90,0.07) 0%, transparent 70%),
    radial-gradient(ellipse 60% 80% at 80% 90%, rgba(245,200,160,0.1) 0%, transparent 70%),
    radial-gradient(ellipse 100% 50% at 50% 50%, rgba(253,248,243,0) 0%, transparent 100%);
  pointer-events: none;
  z-index: 0;
}

/* Grain */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
  opacity: 0.025;
  pointer-events: none;
  z-index: 0;
}

/* ── HEADER ── */
header {
  position: fixed;
  top: 0; left: 0; right: 0;
  padding: 1.6rem 2.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  z-index: 10;
}

.logo {
  font-family: 'Cormorant Garamond', serif;
  font-size: 1.25rem;
  font-weight: 400;
  letter-spacing: 0.01em;
  color: var(--text);
}
.logo span { color: var(--accent); }

.header-tag {
  font-size: 0.7rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--muted);
}

/* ── MAIN STAGE ── */
.stage {
  position: relative;
  z-index: 1;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 7rem 2rem 5rem;
}

/* ── INTRO STATE ── */
#introView {
  text-align: center;
  animation: fadeUp 0.9s ease-out both;
}

.eyebrow {
  font-size: 0.7rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 2rem;
  animation: fadeUp 0.9s 0.1s ease-out both;
}

.headline {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(2.6rem, 6vw, 5rem);
  font-weight: 300;
  line-height: 1.15;
  letter-spacing: -0.02em;
  color: var(--text);
  max-width: 640px;
  margin: 0 auto 1.4rem;
  animation: fadeUp 0.9s 0.2s ease-out both;
}

.headline em {
  font-style: italic;
  color: var(--accent);
}

.subline {
  font-size: 0.95rem;
  color: var(--muted);
  font-weight: 300;
  line-height: 1.7;
  max-width: 380px;
  margin: 0 auto 3.5rem;
  animation: fadeUp 0.9s 0.3s ease-out both;
}

/* ── NEED SELECTOR ── */
.need-prompt {
  font-size: 0.78rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 1.2rem;
  animation: fadeUp 0.9s 0.4s ease-out both;
}

.needs-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 0.6rem;
  justify-content: center;
  max-width: 500px;
  margin: 0 auto 3rem;
  animation: fadeUp 0.9s 0.5s ease-out both;
}

.need-chip {
  padding: 0.55rem 1.2rem;
  border-radius: 50px;
  border: 1px solid rgba(196,120,90,0.25);
  background: rgba(196,120,90,0.04);
  font-family: 'Cormorant Garamond', serif;
  font-size: 1rem;
  font-style: italic;
  color: var(--text);
  cursor: pointer;
  transition: all 0.25s ease;
  user-select: none;
}
.need-chip:hover {
  border-color: var(--accent);
  background: rgba(196,120,90,0.1);
  transform: translateY(-1px);
}
.need-chip.selected {
  border-color: var(--accent);
  background: var(--accent);
  color: #fff;
}

/* ── CTA BUTTON ── */
.btn-receive {
  display: inline-flex;
  align-items: center;
  gap: 0.7rem;
  background: var(--text);
  color: var(--bg);
  border: none;
  border-radius: 50px;
  padding: 1rem 2.4rem;
  font-family: 'Instrument Sans', sans-serif;
  font-size: 0.88rem;
  font-weight: 400;
  letter-spacing: 0.04em;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
  animation: fadeUp 0.9s 0.6s ease-out both;
}
.btn-receive:hover {
  background: var(--accent2);
  transform: translateY(-2px);
  box-shadow: 0 12px 40px rgba(139,79,58,0.25);
}
.btn-receive svg { width: 16px; height: 16px; opacity: 0.7; }

/* ── LOADING STATE ── */
#loadingView {
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 2rem;
  text-align: center;
}
#loadingView.visible { display: flex; }

.loading-text {
  font-family: 'Cormorant Garamond', serif;
  font-size: 1.3rem;
  font-style: italic;
  color: var(--muted);
  animation: breathe 2s ease-in-out infinite;
}

.heartbeat {
  display: flex;
  gap: 5px;
  align-items: center;
}
.hb {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: var(--accent);
  animation: hbpulse 1.4s ease-in-out infinite;
}
.hb:nth-child(2) { animation-delay: 0.2s; width: 7px; height: 7px; }
.hb:nth-child(3) { animation-delay: 0.4s; }

/* ── MESSAGE STATE ── */
#messageView {
  display: none;
  flex-direction: column;
  align-items: center;
  max-width: 640px;
  width: 100%;
  text-align: center;
}
#messageView.visible {
  display: flex;
  animation: fadeUp 0.8s ease-out both;
}

/* Letter card */
.letter {
  background: #FFFCF8;
  border: 1px solid rgba(196,120,90,0.15);
  border-radius: 4px 4px 4px 28px;
  padding: 3rem 3.5rem;
  position: relative;
  box-shadow:
    0 2px 8px rgba(196,120,90,0.06),
    0 20px 60px rgba(139,79,58,0.08);
  margin-bottom: 2rem;
  width: 100%;
}

/* Corner fold effect */
.letter::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0;
  width: 28px; height: 28px;
  background: linear-gradient(135deg, var(--soft) 50%, transparent 50%);
  border-radius: 0 4px 0 0;
}

.letter-salutation {
  font-family: 'Cormorant Garamond', serif;
  font-size: 1rem;
  font-style: italic;
  color: var(--muted);
  margin-bottom: 1.5rem;
  display: block;
  text-align: left;
}

.letter-body {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(1.3rem, 2.5vw, 1.7rem);
  font-weight: 300;
  line-height: 1.65;
  color: var(--text);
  text-align: left;
}

.letter-closing {
  font-family: 'Cormorant Garamond', serif;
  font-size: 1rem;
  font-style: italic;
  color: var(--muted);
  margin-top: 1.8rem;
  display: block;
  text-align: right;
}

/* Tag under letter */
.need-tag {
  font-size: 0.7rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 2.5rem;
}
.need-tag span {
  color: var(--accent);
}

/* Action row */
.msg-actions {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  justify-content: center;
}

.btn-again {
  background: var(--text);
  color: var(--bg);
  border: none;
  border-radius: 50px;
  padding: 0.85rem 2rem;
  font-family: 'Instrument Sans', sans-serif;
  font-size: 0.82rem;
  letter-spacing: 0.04em;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}
.btn-again:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(44,35,24,0.2);
}

.btn-ghost {
  background: none;
  color: var(--muted);
  border: 1px solid rgba(196,120,90,0.25);
  border-radius: 50px;
  padding: 0.85rem 2rem;
  font-family: 'Instrument Sans', sans-serif;
  font-size: 0.82rem;
  letter-spacing: 0.04em;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.btn-ghost:hover {
  border-color: var(--accent);
  color: var(--text);
}
.btn-ghost svg { width: 15px; height: 15px; }

/* ── FOOTER ── */
footer {
  position: fixed;
  bottom: 1.5rem;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.65rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--muted);
  opacity: 0.4;
  white-space: nowrap;
  z-index: 1;
}

/* ── TOAST ── */
.toast {
  position: fixed;
  bottom: 3.5rem;
  left: 50%;
  transform: translateX(-50%) translateY(8px);
  background: var(--text);
  color: var(--bg);
  padding: 0.6rem 1.4rem;
  border-radius: 50px;
  font-size: 0.78rem;
  letter-spacing: 0.03em;
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 200;
  white-space: nowrap;
  pointer-events: none;
  font-family: 'Instrument Sans', sans-serif;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ── ANIMATIONS ── */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(22px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes breathe {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}
@keyframes hbpulse {
  0%, 100% { transform: scale(0.7); opacity: 0.3; }
  50% { transform: scale(1); opacity: 1; }
}

@media (max-width: 600px) {
  header { padding: 1.4rem 1.5rem; }
  .letter { padding: 2rem 1.8rem; }
  .needs-grid { gap: 0.5rem; }
  .msg-actions { gap: 0.7rem; }
}
</style>
</head>
<body>

<header>
  <div class="logo">tellme<span>.mom</span></div>
  <div class="header-tag">A safe place</div>
</header>

<div class="stage">

  <!-- INTRO -->
  <div id="introView">
    <div class="eyebrow">For every child who needed to hear it</div>
    <h1 class="headline">
      The words your<br><em>mom never said</em><br>— but should have.
    </h1>
    <p class="subline">
      Some of us grew up without the words we needed most. They're here now. Whenever you're ready.
    </p>

    <div class="need-prompt">What do you need to hear today?</div>
    <div class="needs-grid" id="needsGrid">
      <div class="need-chip" data-need="pride">I'm proud of you</div>
      <div class="need-chip" data-need="love">I love you unconditionally</div>
      <div class="need-chip" data-need="enough">You are enough</div>
      <div class="need-chip" data-need="forgiveness">I forgive you</div>
      <div class="need-chip" data-need="safe">You are safe with me</div>
      <div class="need-chip" data-need="strong">You can do hard things</div>
      <div class="need-chip" data-need="seen">I see you</div>
      <div class="need-chip" data-need="home">You always have a home</div>
    </div>

    <button class="btn-receive" id="receiveBtn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" fill="currentColor"/>
      </svg>
      Receive these words
    </button>
  </div>

  <!-- LOADING -->
  <div id="loadingView">
    <div class="loading-text">She's thinking of you…</div>
    <div class="heartbeat">
      <div class="hb"></div>
      <div class="hb"></div>
      <div class="hb"></div>
    </div>
  </div>

  <!-- MESSAGE -->
  <div id="messageView">
    <div class="need-tag">A message about <span id="needLabel"></span></div>
    <div class="letter">
      <span class="letter-salutation">My dear,</span>
      <p class="letter-body" id="letterBody"></p>
      <span class="letter-closing">With all my love, Mom</span>
    </div>
    <div class="msg-actions">
      <button class="btn-again" id="againBtn">Hear it again, differently</button>
      <button class="btn-ghost" id="shareBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
          <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
          <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
          <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
        </svg>
        Share
      </button>
      <button class="btn-ghost" id="backBtn">
        ← Choose another
      </button>
    </div>
  </div>

</div>

<footer>tellme.mom — for those who needed to hear it</footer>
<div class="toast" id="toast"></div>

<script>
var currentNeed = null;
var currentMessage = "";

var needLabels = {
  pride: "being proud of you",
  love: "unconditional love",
  enough: "being enough",
  forgiveness: "forgiveness",
  safe: "feeling safe",
  strong: "your strength",
  seen: "being seen",
  home: "always having a home"
};

// Chip selection
document.getElementById("needsGrid").addEventListener("click", function(e) {
  var chip = e.target.closest(".need-chip");
  if (!chip) return;
  document.querySelectorAll(".need-chip").forEach(function(c) { c.classList.remove("selected"); });
  chip.classList.add("selected");
  currentNeed = chip.getAttribute("data-need");
});

document.getElementById("receiveBtn").addEventListener("click", function() {
  if (!currentNeed) {
    // Auto-select random if none chosen
    var chips = document.querySelectorAll(".need-chip");
    var rand = chips[Math.floor(Math.random() * chips.length)];
    rand.classList.add("selected");
    currentNeed = rand.getAttribute("data-need");
  }
  showLoading();
  generateMessage(currentNeed, function(msg) {
    showMessage(msg, currentNeed);
  });
});

document.getElementById("againBtn").addEventListener("click", function() {
  showLoading();
  generateMessage(currentNeed, function(msg) {
    showMessage(msg, currentNeed);
  });
});

document.getElementById("backBtn").addEventListener("click", function() {
  document.getElementById("messageView").classList.remove("visible");
  document.getElementById("messageView").style.display = "none";
  document.getElementById("introView").style.display = "";
  document.getElementById("introView").style.animation = "fadeUp 0.6s ease-out both";
  currentNeed = null;
  document.querySelectorAll(".need-chip").forEach(function(c) { c.classList.remove("selected"); });
});

document.getElementById("shareBtn").addEventListener("click", function() {
  shareCard();
});

function showLoading() {
  document.getElementById("introView").style.display = "none";
  document.getElementById("messageView").classList.remove("visible");
  document.getElementById("messageView").style.display = "none";
  document.getElementById("loadingView").classList.add("visible");
}

function showMessage(msg, need) {
  currentMessage = msg;
  document.getElementById("loadingView").classList.remove("visible");
  document.getElementById("letterBody").textContent = msg;
  document.getElementById("needLabel").textContent = needLabels[need] || need;
  var mv = document.getElementById("messageView");
  mv.style.display = "flex";
  void mv.offsetWidth;
  mv.classList.add("visible");
}

function generateMessage(need, cb) {
  fetch("/api/message", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ need: need })
  })
  .then(function(r) { return r.json(); })
  .then(function(data) {
    if (data.message) {
      cb(data.message);
    } else {
      cb("You are so deeply loved. More than words can hold. I should have said this every single day.");
    }
  })
  .catch(function() {
    cb("You are so deeply loved. More than words can hold. I should have said this every single day.");
  });
}

function showToast(msg) {
  var t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(function() { t.classList.remove("show"); }, 2400);
}

function shareCard() {
  if (!currentMessage) return;

  var W = 1080, H = 1920;
  var canvas = document.createElement("canvas");
  canvas.width = W; canvas.height = H;
  var ctx = canvas.getContext("2d");

  // Warm creamy background
  var bg = ctx.createLinearGradient(0, 0, W, H);
  bg.addColorStop(0, "#FDF6EE");
  bg.addColorStop(0.5, "#F8EDE0");
  bg.addColorStop(1, "#F2E4D0");
  ctx.fillStyle = bg;
  ctx.fillRect(0, 0, W, H);

  // Soft glow spots
  function glow(x, y, r, color) {
    var g = ctx.createRadialGradient(x, y, 0, x, y, r);
    g.addColorStop(0, color);
    g.addColorStop(1, "transparent");
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI*2);
    ctx.fill();
  }
  glow(W*0.1, H*0.08, 600, "rgba(196,120,90,0.1)");
  glow(W*0.9, H*0.92, 700, "rgba(196,120,90,0.08)");
  glow(W*0.5, H*0.5, 900, "rgba(245,230,210,0.3)");

  // Top label
  ctx.font = "300 30px 'Instrument Sans', sans-serif";
  ctx.fillStyle = "rgba(168,150,126,0.8)";
  ctx.textAlign = "center";
  ctx.letterSpacing = "8px";
  ctx.fillText("A MESSAGE FROM MOM", W/2, 130);

  // Thin line
  ctx.strokeStyle = "rgba(196,120,90,0.25)";
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(W/2 - 120, 160);
  ctx.lineTo(W/2 + 120, 160);
  ctx.stroke();

  // Salutation
  ctx.font = "italic 300 44px 'Cormorant Garamond', Georgia, serif";
  ctx.fillStyle = "rgba(168,150,126,0.9)";
  ctx.textAlign = "left";
  ctx.fillText("My dear,", 130, 280);

  // Message body — word wrap
  var fontSize = Math.min(68, Math.max(44, Math.floor(4200 / Math.max(currentMessage.length, 1))));
  ctx.font = "300 " + fontSize + "px 'Cormorant Garamond', Georgia, serif";
  ctx.fillStyle = "#2C2318";
  ctx.textAlign = "left";

  var maxW = W - 260;
  var lineH = fontSize * 1.55;
  var words = currentMessage.split(" ");
  var lines = [];
  var line = "";
  for (var i = 0; i < words.length; i++) {
    var test = line ? line + " " + words[i] : words[i];
    if (ctx.measureText(test).width > maxW) {
      if (line) lines.push(line);
      line = words[i];
    } else {
      line = test;
    }
  }
  if (line) lines.push(line);

  var totalH = lines.length * lineH;
  var startY = (H - totalH) / 2 - 80;

  for (var j = 0; j < lines.length; j++) {
    ctx.fillText(lines[j], 130, startY + j * lineH);
  }

  // Closing
  var closeY = startY + lines.length * lineH + 80;
  ctx.font = "italic 300 44px 'Cormorant Garamond', Georgia, serif";
  ctx.fillStyle = "rgba(168,150,126,0.9)";
  ctx.textAlign = "right";
  ctx.fillText("With all my love, Mom", W - 130, closeY);

  // Bottom rule
  ctx.strokeStyle = "rgba(196,120,90,0.2)";
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(W/2 - 100, H - 180);
  ctx.lineTo(W/2 + 100, H - 180);
  ctx.stroke();

  // Domain
  ctx.font = "300 34px 'Instrument Sans', sans-serif";
  ctx.fillStyle = "rgba(196,120,90,0.7)";
  ctx.textAlign = "center";
  ctx.fillText("tellme.mom", W/2, H - 130);

  var link = document.createElement("a");
  link.download = "tellmemom-" + Date.now() + ".png";
  link.href = canvas.toDataURL("image/png");
  link.click();
  showToast("Card saved ✦");
}
</script>
</body>
</html>
